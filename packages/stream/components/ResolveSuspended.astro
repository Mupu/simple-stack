---
import type { LocalsWithStreamInternals } from "./types";

const { stream } = Astro.locals as LocalsWithStreamInternals;

const resolvedHtml = await Promise.all(
  stream.components
);
---

{
  resolvedHtml.map( (html, idx) => (
    <>
      <template data-suspense-id={idx} set:html={html} />
      <script is:inline define:vars={{ id: idx }}>
        const template = document.querySelector(`[data-suspense-id="${id}"]`).content;
        const dest = document.getElementById(id);
        dest.replaceWith(template);
      </script>
    </>
  ))
}